angular.module("app.studentctrl",["app.db"]).controller("studentCtrl",["$scope","$ionicModal","$ionicPlatform","db",function(e,t,d,n){t.fromTemplateUrl("templates/student-modal.html",{scope:e}).then(function(t){e.studentAddEditModal=t}),e.state={showStudentEditMode:!1,markedStudents:new Object,studentSearch:"",collapseNameForm:!1,collapseGenderForm:!0,collapseContactForm:!0,collapseAddressForm:!0},d.ready(function(){n.init().then(function(){e.studentList=n.searchStudentList(""),e.$watch(function(){return n.getStudentListChanged()},function(){e.studentList=n.searchStudentList(e.state.studentSearch)})})}),e.keyPressed=function(e){13==e.keyCode&&"undefined"!=typeof cordova&&cordova.plugins.Keyboard.close()},e.onSearchChange=function(t){e.studentList=n.searchStudentList(t.studentSearch)},e.showStudentAddEditModal=function(t,d){d?(t.studentId=d.$loki,t.studentFirstName=d.firstName,t.studentLastName=d.lastName,t.studentGender=d.gender,t.studentEmail=d.email,t.studentHomePhoneNumber=d.homePhoneNumber,t.studentMobilePhoneNumber=d.mobilePhoneNumber,t.studentStreet=d.street,t.studentCity=d.city,t.studentPostalCode=d.postalCode,t.newStudent=!1):(t.studentFirstName="",t.studentLastName="",t.studentGender="Male",t.studentEmail="",t.studentHomePhoneNumber="",t.studentMobilePhoneNumber="",t.studentStreet="",t.studentCity="",t.studentPostalCode="",t.newStudent=!0),t.collapseNameForm=!1,t.collapseGenderForm=!0,t.collapseContactForm=!0,t.collapseAddressForm=!0,e.studentAddEditModal.show()},e.addStudentRecord=function(t){n.addStudent(void 0,{firstName:t.studentFirstName,lastName:t.studentLastName,gender:t.studentGender,email:t.studentEmail,homePhoneNumber:t.studentHomePhoneNumber,mobilePhoneNumber:t.studentMobilePhoneNumber,street:t.studentStreet,city:t.studentCity,postalCode:t.studentPostalCode});e.studentList=n.searchStudentList(t.studentSearch),e.studentAddEditModal.hide()},e.updateStudentRecord=function(t){var d=n.getStudent(t.studentId);d.firstName=t.studentFirstName,d.lastName=t.studentLastName,d.gender=t.studentGender,d.email=t.studentEmail,d.homePhoneNumber=t.studentHomePhoneNumber,d.mobilePhoneNumber=t.studentMobilePhoneNumber,d.street=t.studentStreet,d.city=t.studentCity,d.postalCode=t.studentPostalCode,n.updateStudent(d),e.studentList=n.searchStudentList(t.studentSearch),e.studentAddEditModal.hide()},e.unmarkAllStudents=function(t){for(var d=0;d<e.studentList.length;d++)t.markedStudents[d.toString()]=!1},e.toggleShowStudentEditMode=function(t){t.showStudentEditMode=t.showStudentEditMode?!1:!0;for(var d=0;d<e.studentList.length;d++)t.markedStudents[d.toString()]=!1},e.deleteSelectedStudents=function(t){for(var d in t.markedStudents)if(t.markedStudents[d]===!0){t.markedStudents[d]=void 0;var o=Number(d),s=e.studentList[o];n.deleteStudent(s.$loki)}e.studentList=n.searchStudentList(t.studentSearch)},e.collapseNameForm=function(e){e.collapseNameForm=!1,e.collapseGenderForm=!0,e.collapseContactForm=!0,e.collapseAddressForm=!0},e.collapseGenderForm=function(e){e.collapseNameForm=!0,e.collapseGenderForm=!1,e.collapseContactForm=!0,e.collapseAddressForm=!0},e.collapseContactForm=function(e){e.collapseNameForm=!0,e.collapseGenderForm=!0,e.collapseContactForm=!1,e.collapseAddressForm=!0},e.collapseAddressForm=function(e){e.collapseNameForm=!0,e.collapseGenderForm=!0,e.collapseContactForm=!0,e.collapseAddressForm=!1}}]);